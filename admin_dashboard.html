<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ржЕржирзБрж╢рзАрж▓ржирзА | ржЕржзрзНржпрж╛рзЯ рзз</title>
  <link rel="stylesheet" href="admin_dashboard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">
  <!-- Font Awesome CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
  <script>
    // ржпржжрж┐ рж▓ржЧ ржЗржи ржирж╛ ржХрж░рж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ admin login page ржП ржкрж╛ржарж╛ржУ
    if (localStorage.getItem("isAdminLoggedIn") !== "true") {
      window.location.href = "http://localhost/onusiloni/admin-login.html";
    }
  </script>
  
  
  <!-- тЬЕ Navigation Bar -->
  <nav class="navbar" id="mainNav">
    <div class="logo">ржЕржирзБрж╢рзАрж▓ржирзА</div> 
    <ul class="nav-links">
      <li><a href="home.html">рж╣рзЛржо</a></li>
      <li class="dropdown">
        <a href="#">ржЕржзрзНржпрж╛рзЯрж╕ржорзВрж╣ тЦ╛</a>
        <ul class="dropdown-menu">
          <li><a href="chapter1.html">ржЕржзрзНржпрж╛рзЯ рзз: рж░рж╕рж╛рзЯржирзЗрж░ ржкрж░рж┐ржЪрж┐рждрж┐</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзи: рж▓рзНржпрж╛ржм ржирж┐рж░рж╛ржкрждрзНрждрж╛</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзй: ржЕрзНржпрж╛рж╕рж┐ржб ржУ ржХрзНрж╖рж╛рж░</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзк: рж░рж╛рж╕рж╛рзЯржирж┐ржХ ржмрж┐ржХрзНрж░рж┐рзЯрж╛</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзл: ржкрзГржержХрзАржХрж░ржг ржХрзМрж╢рж▓</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзм: ржкрж░рж┐ржорж╛ржк</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзн: ржЧрзНржпрж╛рж╕ рж╕рзВрждрзНрж░</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзо: ржкрж┐ржПржЗржЪ ржкрж░рзАржХрзНрж╖рж╛</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рзп: рж▓ржмржг</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рззрзж: ржмрзИржжрзНржпрзБрждрзНрж░рж╛ржкрзЗржХрзНрж╖</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рззрзз: ржЬрзИржм рж░рж╕рж╛рзЯржи</a></li>
          <li><a href="#">ржЕржзрзНржпрж╛рзЯ рззрзи: ржкрзБржирж░рж╛ржмрзГрждрзНрждрж┐</a></li>
        </ul>
      </li>
      <li><a href="#">ржЕржнрж┐ржпрзЛржЧ</a></li>
      <li><a href="#">ржмрзНрж▓ржЧ</a></li>
      <li><a href="#">ржЖржорж╛ржжрзЗрж░ рж╕ржорзНржкрж░рзНржХрзЗ</a></li>
      <li><a href="#" id="text">рж▓ржЧржЗржи</a></li>
      <li><a href="#">ржЕрзНржпрж╛ржбржорж┐ржи</a></li>
    </ul>
  </nav>

  <div class="section">
    <h2>ЁЯФ╣ рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░рзНржб ржЗржЙржЬрж╛рж░ рждрж╛рж▓рж┐ржХрж╛</h2>
    <table id="registrationTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>ржирж╛ржо</th>
          <th>Role</th>
          <th>ржкрзНрж░рждрж┐рж╖рзНржарж╛ржи</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>ЁЯФ╕ ржЕржнрж┐ржпрзЛржЧ рждрж╛рж▓рж┐ржХрж╛</h2>
    <table id="complaintTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Chapter</th>
          <th>Topic</th>
          <th>Experiment</th>
          <th>Email</th>
          <th>Complain</th>
          <th>Status</th>
          <th>Update</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<button onclick="logout()" class="logout-container logout-btn">Logout</button>


<script>
  function logout() {
    localStorage.removeItem("isAdminLoggedIn");
    window.location.href = "admin-login.html";
  }
</script>


  <script>
    window.addEventListener('DOMContentLoaded', () => {
      fetch("admin_dashboard.php")
        .then(res => res.json())
        .then(data => {
          const regBody = document.querySelector("#registrationTable tbody");
          data.registrations.forEach(r => {
            const row = `<tr>
              <td>${r.id}</td>
              <td>${r.name}</td>
              <td>${r.role}</td>
              <td>${r.institution}</td>
            </tr>`;
            regBody.innerHTML += row;
          });

          const compBody = document.querySelector("#complaintTable tbody");
          data.complaints.forEach(c => {
            const row = `<tr>
              <td>${c.id}</td>
              <td>${c.chapter}</td>
              <td>${c.topic}</td>
              <td>${c.experiment}</td>
              <td>${c.email}</td>
              <td>${c.complain}</td>
              <td>
                <select id="status-${c.id}">
                  <option value="new" ${c.status == "new" ? "selected" : ""}>New</option>
                  <option value="pending" ${c.status == "pending" ? "selected" : ""}>Pending</option>
                  <option value="resolved" ${c.status == "resolved" ? "selected" : ""}>Resolved</option>
                </select>
              </td>
              <td><button onclick="updateStatus(${c.id})">Update</button></td>
            </tr>`;
            compBody.innerHTML += row;
          });
        })
        .catch(err => {
          alert("Data load failed!");
          console.error(err);
        });
    });

    function updateStatus(id) {
      const status = document.getElementById(`status-${id}`).value;
      fetch("http://localhost/onusiloni/update_status.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `id=${id}&status=${status}`
      })
        .then(res => res.text())
        .then(msg => alert(msg))
        .catch(err => alert("Update failed"));
    }
  </script>

</body>
</html>
